shadow$provide.module$node_modules$gtoken$build$src$index=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});global=require("shadow$empty");var gaxios_1=require("module$node_modules$gaxios$build$src$index"),jws=require("module$node_modules$jws$index"),mime=require("module$node_modules$mime$index");module=require("module$node_modules$util$util");var readFile=global.readFile?module.promisify(global.readFile):function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){throw new ErrorWithCode("use key rather than keyFile.",
"MISSING_CREDENTIALS");})},ErrorWithCode=function(message,code){message=Error.call(this,message);this.message=message.message;"stack"in message&&(this.stack=message.stack);this.code=code};$jscomp.inherits(ErrorWithCode,Error);var getPem;global=function(options){this.configure(options)};global.prototype.hasExpired=function(){var now=(new Date).getTime();return this.rawToken&&this.expiresAt?now>=this.expiresAt:!0};global.prototype.getToken=function(callback,opts){opts=void 0===opts?{}:opts;"object"===
typeof callback&&(opts=callback,callback=void 0);opts=Object.assign({forceRefresh:!1},opts);if(callback){var cb=callback;this.getTokenAsync(opts).then(function(t){return cb(null,t)},callback)}else return this.getTokenAsync(opts)};global.prototype.getCredentials=function(keyFile){var mimeType,key,body,privateKey,clientEmail,privateKey$27,privateKey$28;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){switch($jscomp$generator$context.nextAddress){case 1:switch(mimeType=
mime.getType(keyFile),mimeType){case "application/json":return $jscomp$generator$context.jumpTo(2);case "application/x-x509-ca-cert":return $jscomp$generator$context.jumpTo(3);case "application/x-pkcs12":return $jscomp$generator$context.jumpTo(4);default:throw new ErrorWithCode("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, *.pem, and *.p12.","UNKNOWN_CERTIFICATE_TYPE");}case 2:return $jscomp$generator$context.yield(readFile(keyFile,
"utf8"),6);case 6:key=$jscomp$generator$context.yieldResult;body=JSON.parse(key);privateKey=body.private_key;clientEmail=body.client_email;if(!privateKey||!clientEmail)throw new ErrorWithCode("private_key and client_email are required.","MISSING_CREDENTIALS");return $jscomp$generator$context.return({privateKey:privateKey,clientEmail:clientEmail});case 3:return $jscomp$generator$context.yield(readFile(keyFile,"utf8"),7);case 7:return privateKey$27=$jscomp$generator$context.yieldResult,$jscomp$generator$context.return({privateKey:privateKey$27});
case 4:if(getPem){$jscomp$generator$context.jumpTo(8);break}return $jscomp$generator$context.yield(Promise.resolve().then(function(){return require("module$node_modules$google_p12_pem$build$src$index")}),9);case 9:getPem=$jscomp$generator$context.yieldResult.getPem;case 8:return $jscomp$generator$context.yield(getPem(keyFile),10);case 10:return privateKey$28=$jscomp$generator$context.yieldResult,$jscomp$generator$context.return({privateKey:privateKey$28})}})};global.prototype.getTokenAsync=function(opts){var $jscomp$async$this=
this,creds;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress){if(!1===$jscomp$async$this.hasExpired()&&!1===opts.forceRefresh)return $jscomp$generator$context.return(Promise.resolve($jscomp$async$this.rawToken));if(!$jscomp$async$this.key&&!$jscomp$async$this.keyFile)throw Error("No key or keyFile set.");return $jscomp$async$this.key||!$jscomp$async$this.keyFile?$jscomp$generator$context.jumpTo(2):$jscomp$generator$context.yield($jscomp$async$this.getCredentials($jscomp$async$this.keyFile),
3)}2!=$jscomp$generator$context.nextAddress&&(creds=$jscomp$generator$context.yieldResult,$jscomp$async$this.key=creds.privateKey,$jscomp$async$this.iss=creds.clientEmail||$jscomp$async$this.iss,creds.clientEmail||$jscomp$async$this.ensureEmail());return $jscomp$generator$context.return($jscomp$async$this.requestToken())})};global.prototype.ensureEmail=function(){if(!this.iss)throw new ErrorWithCode("email is required.","MISSING_CREDENTIALS");};global.prototype.revokeToken=function(callback){if(callback)this.revokeTokenAsync().then(function(){return callback()},
callback);else return this.revokeTokenAsync()};global.prototype.revokeTokenAsync=function(){var $jscomp$async$this=this,url;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress){if(!$jscomp$async$this.accessToken)throw Error("No token to revoke.");url="https://accounts.google.com/o/oauth2/revoke?token\x3d"+$jscomp$async$this.accessToken;return $jscomp$generator$context.yield(gaxios_1.request({url:url}),2)}$jscomp$async$this.configure({email:$jscomp$async$this.iss,
sub:$jscomp$async$this.sub,key:$jscomp$async$this.key,keyFile:$jscomp$async$this.keyFile,scope:$jscomp$async$this.scope,additionalClaims:$jscomp$async$this.additionalClaims});$jscomp$generator$context.jumpToEnd()})};global.prototype.configure=function(options){options=void 0===options?{}:options;this.keyFile=options.keyFile;this.key=options.key;this.rawToken=void 0;this.iss=options.email||options.iss;this.sub=options.sub;this.additionalClaims=options.additionalClaims;this.scope="object"===typeof options.scope?
options.scope.join(" "):options.scope};global.prototype.requestToken=function(){var $jscomp$async$this=this,iat,additionalClaims,payload,signedJWT,r,e,body,desc;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress)return iat=Math.floor((new Date).getTime()/1E3),additionalClaims=$jscomp$async$this.additionalClaims||{},payload=Object.assign({iss:$jscomp$async$this.iss,scope:$jscomp$async$this.scope,aud:"https://www.googleapis.com/oauth2/v4/token",
exp:iat+3600,iat:iat,sub:$jscomp$async$this.sub},additionalClaims),signedJWT=jws.sign({header:{alg:"RS256"},payload:payload,secret:$jscomp$async$this.key}),$jscomp$generator$context.setCatchFinallyBlocks(2),$jscomp$generator$context.yield(gaxios_1.request({method:"POST",url:"https://www.googleapis.com/oauth2/v4/token",data:{grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:signedJWT},headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"json"}),4);if(2!=$jscomp$generator$context.nextAddress)return r=
$jscomp$generator$context.yieldResult,$jscomp$async$this.rawToken=r.data,$jscomp$async$this.expiresAt=null===r.data.expires_in||void 0===r.data.expires_in?void 0:1E3*(iat+r.data.expires_in),$jscomp$generator$context.return($jscomp$async$this.rawToken);e=$jscomp$generator$context.enterCatchBlock();$jscomp$async$this.rawToken=void 0;$jscomp$async$this.tokenExpires=void 0;body=e.response&&e.response.data?e.response.data:{};body.error&&(desc=body.error_description?": "+body.error_description:"",e.message=
""+body.error+desc);throw e;})};$jscomp.global.Object.defineProperties(global.prototype,{accessToken:{configurable:!0,enumerable:!0,get:function(){return this.rawToken?this.rawToken.access_token:void 0}},idToken:{configurable:!0,enumerable:!0,get:function(){return this.rawToken?this.rawToken.id_token:void 0}},tokenType:{configurable:!0,enumerable:!0,get:function(){return this.rawToken?this.rawToken.token_type:void 0}},refreshToken:{configurable:!0,enumerable:!0,get:function(){return this.rawToken?
this.rawToken.refresh_token:void 0}}});exports.GoogleToken=global}
//# sourceMappingURL=module$node_modules$gtoken$build$src$index.js.map
