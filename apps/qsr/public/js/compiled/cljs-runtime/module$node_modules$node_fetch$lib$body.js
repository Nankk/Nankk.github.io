shadow$provide.module$node_modules$node_fetch$lib$body=function(global,require,module,exports){function Body(body,opts){opts=opts||{};this.body=body;this.bodyUsed=!1;this.size=opts.size||0;this.timeout=opts.timeout||0;this._raw=[];this._abort=!1}var Buffer=require("module$node_modules$buffer$index").Buffer,convert=require("module$node_modules$encoding$lib$encoding").convert,bodyStream=require("module$node_modules$is_stream$index"),PassThrough=require("module$node_modules$stream_browserify$index").PassThrough,
FetchError=require("module$node_modules$node_fetch$lib$fetch_error");module.exports=Body;Body.prototype.json=function(){var self=this;return this._decode().then(function(buffer){try{return JSON.parse(buffer.toString())}catch(err){return Body.Promise.reject(new FetchError("invalid json response body at "+self.url+" reason: "+err.message,"invalid-json"))}})};Body.prototype.text=function(){return this._decode().then(function(buffer){return buffer.toString()})};Body.prototype.buffer=function(){return this._decode()};
Body.prototype._decode=function(){var self=this;if(this.bodyUsed)return Body.Promise.reject(Error("body used already for: "+this.url));this.bodyUsed=!0;this._bytes=0;this._abort=!1;this._raw=[];return new Body.Promise(function(resolve,reject){var resTimeout;if("string"===typeof self.body)return self._bytes=self.body.length,self._raw=[new Buffer(self.body)],resolve(self._convert());if(self.body instanceof Buffer)return self._bytes=self.body.length,self._raw=[self.body],resolve(self._convert());self.timeout&&
(resTimeout=setTimeout(function(){self._abort=!0;reject(new FetchError("response timeout at "+self.url+" over limit: "+self.timeout,"body-timeout"))},self.timeout));self.body.on("error",function(err){reject(new FetchError("invalid response body at: "+self.url+" reason: "+err.message,"system",err))});self.body.on("data",function(chunk){self._abort||null===chunk||(self.size&&self._bytes+chunk.length>self.size?(self._abort=!0,reject(new FetchError("content size at "+self.url+" over limit: "+self.size,
"max-size"))):(self._bytes+=chunk.length,self._raw.push(chunk)))});self.body.on("end",function(){self._abort||(clearTimeout(resTimeout),resolve(self._convert()))})})};Body.prototype._convert=function(encoding){encoding=encoding||"utf-8";var ct=this.headers.get("content-type"),charset="utf-8";if(ct){if(!/text\/html|text\/plain|\+xml|\/xml/i.test(ct))return Buffer.concat(this._raw);var res=/charset=([^;]*)/i.exec(ct)}if(!res&&0<this._raw.length){for(ct=0;ct<this._raw.length&&!(str+=this._raw[ct].toString(),
1024<str.length);ct++);var str=str.substr(0,1024)}!res&&str&&(res=/<meta.+?charset=(['"])(.+?)\1/i.exec(str));!res&&str&&(res=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(str))&&(res=/charset=(.*)/i.exec(res.pop()));!res&&str&&(res=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(str));res&&(charset=res.pop(),"gb2312"===charset||"gbk"===charset)&&(charset="gb18030");return convert(Buffer.concat(this._raw),encoding,charset)};Body.prototype._clone=function(instance){var body=
instance.body;if(instance.bodyUsed)throw Error("cannot clone body after it is used");if(bodyStream(body)&&"function"!==typeof body.getBoundary){var p1=new PassThrough;var p2=new PassThrough;body.pipe(p1);body.pipe(p2);instance.body=p1;body=p2}return body};Body.Promise=global.Promise}
//# sourceMappingURL=module$node_modules$node_fetch$lib$body.js.map
